# WhichClaw 桌面应用技术文档

## 项目概述

**WhichClaw** 是一个类似 Steam/CurseForge 风格的 AI 模型与技能管理桌面应用程序，采用暗黑赛博朋克视觉风格。

### 核心价值

WhichClaw 不仅仅是一个模型管理工具，它是一个**通用的 AI 能力配置中心**，能够为各种软件和工具提供统一的 AI 后台支持：

**🎯 核心能力：**
- **模型热插拔**：为任意软件动态切换 AI 模型（OpenAI、Claude、Llama、Gemini 等）
- **技能编排**：组合多个 AI 技能（WebSearch、CodeInterpreter、ImageGen 等）形成强大工作流
- **配置复用**：创建预设 Profile，一键切换不同场景的 AI 配置
- **实时调试**：可视化查看 AI 调用日志、Token 使用、性能指标

**💡 应用场景：**
1. **开发工具集成**：为 VS Code、JetBrains IDE 等提供可切换的 AI 后端
2. **内容创作平台**：为写作软件、设计工具配置不同的 AI 助手
3. **自动化工作流**：为 RPA 工具、爬虫程序提供智能决策能力
4. **企业 AI 网关**：统一管理团队使用的所有 AI 模型和 API Key
5. **本地 AI 部署**：支持本地运行的开源模型（Llama、Mistral 等）

**🔥 核心优势：**
- ✅ **一处配置，处处可用**：所有软件共享同一套 AI 配置
- ✅ **成本优化**：统一管理 API 调用，避免重复付费
- ✅ **灵活切换**：根据任务需求快速切换最合适的模型
- ✅ **隐私保护**：本地存储 API Key，支持完全离线的本地模型

---

## 技术栈

### 核心框架
- **Electron** `^28.0.0` - 跨平台桌面应用框架
- **React** `^18.3.0` - UI 框架
- **TypeScript** `^5.0.0` - 类型安全
- **Vite** `^5.0.0` - 构建工具

### UI 与样式
- **Tailwind CSS** `^3.4.0` - 原子化 CSS 框架
- **lucide-react** `^0.400.0` - 图标库
- **Google Fonts** - JetBrains Mono, Inter

### 开发工具
- **electron-builder** `^24.0.0` - 打包工具
- **concurrently** - 并行运行开发服务器
- **ESLint** + **Prettier** - 代码规范

---

## 设计系统

### 色彩方案
```css
/* 背景色 */
--bg-primary: #0A0E14;      /* 最深层背景 */
--bg-surface: #11151E;      /* 面板背景 */
--bg-elevated: #161C28;     /* 卡片/浮层 */

/* 强调色 */
--accent-primary: #00FF9D;  /* 荧光绿 - 主按钮/在线状态 */
--accent-secondary: #00D4FF; /* 青蓝 - 链接/选中 */
--accent-warning: #FFC107;  /* 警告黄 */
--accent-error: #FFD700;    /* 亮黄色 - 错误/警告 */

/* 文本色 */
--text-primary: #E0F7FA;    /* 主文本 */
--text-secondary: #94A3B8;  /* 次要文本 */
--text-muted: #64748B;      /* 弱化文本 */

/* 边框/分隔线 */
--border-default: #1A2333;
--border-elevated: #333333;
```

### 字体系统
```css
/* 主界面/代码 */
font-family: 'JetBrains Mono', 'Fira Code', monospace;

/* 辅助文本 */
font-family: 'Inter', 'Manrope', sans-serif;

/* 字号梯度 */
--text-2xl: 24px;  /* 页面标题 */
--text-xl: 20px;   /* Section 标题 */
--text-lg: 16px;   /* 卡片标题 */
--text-base: 14px; /* 正文 */
--text-sm: 12px;   /* 小字/状态 */
--text-xs: 10px;   /* 极小字 */
```

### 圆角与间距
```css
/* 圆角 */
--radius-card: 8px;
--radius-button: 6px;

/* 间距系统 (4px 基准) */
--space-1: 4px;
--space-2: 8px;
--space-3: 12px;
--space-4: 16px;
--space-6: 24px;
--space-8: 32px;
```

---

## 项目结构

```
WhichClaw/
├── electron/                  # Electron 主进程
│   ├── main.ts               # 主进程入口
│   ├── preload.ts            # 预加载脚本 (IPC 桥接)
│   ├── ipc/                  # IPC 通信处理
│   │   ├── modelHandlers.ts  # 模型相关 API
│   │   ├── skillsHandlers.ts # 技能相关 API
│   │   └── toolsHandlers.ts  # 工具扫描 API
│   └── config/               # 配置文件
│       ├── models.json       # 预置模型列表
│       ├── skills.json       # 技能缓存
│       └── skillsMapping.json # 技能源 + 分类映射
│
├── src/                      # React 渲染进程
│   ├── App.tsx               # 应用主框架 (~1300行)
│   ├── main.tsx              # React 入口
│   │
│   ├── components/           # 公共组件 ✅ 已模块化
│   │   ├── index.ts          # 组件统一导出
│   │   ├── Sidebar.tsx       # 左侧导航栏
│   │   ├── NavItem.tsx       # 导航项组件
│   │   ├── CustomSelect.tsx  # 自定义下拉框
│   │   └── cards/            # 卡片组件
│   │       ├── index.ts      # 卡片导出
│   │       ├── ModelCard.tsx # 模型卡片 + 智能图标
│   │       └── ToolCard.tsx  # 工具卡片
│   │
│   ├── types/
│   │   └── electron.d.ts     # Electron API 类型
│   │
│   └── styles/
│       └── index.css         # 全局样式 + Tailwind
│
├── public/                   # 静态资源
│   └── icons/
│       ├── tools/            # 工具图标
│       └── models/           # 模型图标 (18个)
│
├── package.json
├── vite.config.ts            # Vite 配置
├── electron-builder.yml      # 打包配置
├── tailwind.config.js        # Tailwind 配置
├── tsconfig.json             # TypeScript 配置
├── 技术文档.md               # 本文档
└── 后期维护计划.md           # 待办功能
```

---

## 核心功能模块

### 1. Models (模型管理)
**功能:**
- 显示已安装的云端/本地 AI 模型
- 测试连接状态
- 添加/编辑/删除模型
- 显示使用统计

**数据结构:**
```typescript
interface Model {
  id: string;
  name: string;
  type: 'cloud' | 'local' | 'custom';
  provider: string;  // OpenAI, Anthropic, Local
  version: string;
  status: 'online' | 'offline' | 'error';
  apiKey?: string;
  endpoint?: string;
  lastUsed?: Date;
  stats: {
    totalRequests: number;
    successRate: number;
    avgLatency: number;
  };
}
```

### 2. Skills (技能管理)
**功能:**
- 浏览可用技能插件
- 安装/卸载技能
- 查看技能依赖
- 启用/禁用技能

**数据结构:**
```typescript
interface Skill {
  id: string;
  name: string;
  author: string;
  version: string;
  description: string;
  dependencies: string[];  // 依赖的模型 ID
  installed: boolean;
  enabled: boolean;
  category: string;
}
```

### 3. Profiles (运行配置)
**功能:**
- 创建预设配置 (模型 + 技能组合)
- 快速切换配置
- 导出/导入配置 JSON
- 运行配置

**数据结构:**
```typescript
interface Profile {
  id: string;
  name: string;
  modelId: string;
  enabledSkills: string[];
  config: {
    temperature: number;
    maxTokens: number;
    topP: number;
  };
  createdAt: Date;
  lastRun?: Date;
}
```

### 4. Playground (调试页面)
**功能:**
- 实时测试模型 + 技能
- 调整参数
- 查看 Raw JSON 响应
- Token 使用统计
- 请求日志时间线

### 5. Logs (日志监控)
**功能:**
- 实时显示系统日志
- 请求/响应记录
- 错误追踪
- 导出日志

---

## Electron 特性实现

### 窗口管理
```typescript
// electron/main.ts
const mainWindow = new BrowserWindow({
  width: 1400,
  height: 900,
  minWidth: 1200,
  minHeight: 700,
  frame: false,           // 无边框窗口
  backgroundColor: '#0A0E14',
  webPreferences: {
    preload: path.join(__dirname, 'preload.js'),
    contextIsolation: true,
    nodeIntegration: false
  }
});
```

### 系统托盘
```typescript
const tray = new Tray('icon.png');
tray.setContextMenu(Menu.buildFromTemplate([
  { label: 'Show WhichClaw', click: () => mainWindow.show() },
  { label: 'Quit', click: () => app.quit() }
]));
```

### 本地存储
```typescript
// 使用 electron-store
import Store from 'electron-store';

const store = new Store({
  defaults: {
    models: [],
    skills: [],
    profiles: []
  }
});
```

### IPC 通信
```typescript
// 主进程
ipcMain.handle('get-models', async () => {
  return store.get('models');
});

// 渲染进程
const models = await window.electron.getModels();
```

---

## 开发流程

### 1. 初始化项目
```bash
# 创建项目
npm create vite@latest whichclaw -- --template react-ts
cd whichclaw

# 安装依赖
npm install electron electron-builder electron-store
npm install -D concurrently wait-on cross-env

# 安装 UI 依赖
npm install tailwindcss postcss autoprefixer
npm install lucide-react
npx tailwindcss init -p
```

### 2. 配置 Tailwind
```javascript
// tailwind.config.js
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {
      colors: {
        'cyber-bg': '#0A0E14',
        'cyber-surface': '#11151E',
        'cyber-accent': '#00FF9D',
      },
      fontFamily: {
        mono: ['JetBrains Mono', 'monospace'],
        sans: ['Inter', 'sans-serif'],
      }
    }
  }
}
```

### 3. 开发命令
```json
// package.json scripts
{
  "dev": "concurrently \"vite\" \"wait-on http://localhost:5173 && electron .\"",
  "build": "vite build && electron-builder",
  "preview": "vite preview"
}
```

### 4. 打包配置
```yaml
# electron-builder.yml
appId: com.whichclaw.app
productName: WhichClaw
directories:
  output: dist
  buildResources: build

win:
  target:
    - nsis
  icon: build/icon.ico

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
```

---

## 开发优先级

### Phase 1: MVP (最小可行产品)
1. ✅ 项目脚手架搭建
2. ✅ 设计系统实现 (颜色/字体/组件)
3. ✅ 左侧导航栏
4. ✅ Models 页面 (列表 + 添加/编辑)
5. ✅ 基础窗口管理

### Phase 2: 核心功能
1. Skills 浏览与管理
2. Profiles 配置系统
3. Playground 调试页面
4. 本地数据持久化

### Phase 3: 高级特性
1. 系统托盘
2. 全局快捷键
3. 自动更新
4. 日志系统
5. 性能监控

---

## 性能优化建议

1. **虚拟滚动**: 模型/技能列表使用 `react-window`
2. **懒加载**: 页面组件按需加载
3. **缓存**: API 响应缓存
4. **打包优化**: 
   - 使用 `asar` 打包资源
   - Tree-shaking 移除未使用代码
   - 压缩图片资源

---

## 安全建议

1. **API Key 加密**: 使用 `safeStorage` 加密存储
2. **Context Isolation**: 启用上下文隔离
3. **CSP**: 配置内容安全策略
4. **禁用 Node Integration**: 渲染进程禁用 Node.js

---

## 参考资源

- [Electron 官方文档](https://www.electronjs.org/docs)
- [Tailwind CSS 文档](https://tailwindcss.com/docs)
- [Lucide Icons](https://lucide.dev/)
- [electron-builder 文档](https://www.electron.build/)

---

## 下一步行动

1. 初始化 Electron + React + Tailwind 项目
2. 实现设计系统基础组件
3. 开发 Models 页面原型
4. 配置打包流程生成 `.exe`

---

## 后期维护计划

> 💡 详见独立文档 [后期维护计划.md](./后期维护计划.md)

---

## UI 开发规范

### 桌面应用交互原则

**WhichClaw 是桌面应用程序，不是网页！** 所有交互必须遵循桌面应用规范。

**❌ 严禁使用的网页式交互：**
- 禁止使用 `title="..."` 属性显示悬停提示（tooltip）
- 禁止任何 hover 后显示文字说明/浮层提示
- 禁止 hover 变大/缩小/缩放等网页式动画特效
- 禁止使用浏览器原生的 alert()、confirm()、prompt() 弹窗
- 禁止依赖右键菜单作为主要交互

**✅ 正确的桌面应用交互：**
- 重要信息直接在 UI 中显示，不隐藏在 hover 中
- 需要详情时使用点击展开或页面跳转
- 所有交互遵循桌面应用规范（点击、选中、状态切换）
- 使用确定性的状态反馈（颜色变化、图标切换），而非动画暗示

### 赛博朋克风格交互

- **颜色方案**：暗黑背景（#0A0E14）搭配荧光绿（#00FF9D）和青蓝（#00D4FF）强调色
- **视觉层次**：通过颜色饱和度、边框亮度区分层级，避免依赖阴影和悬浮效果
- **状态反馈**：使用颜色变化（选中态、激活态、禁用态）而非动画效果传达状态
- **字体规范**：JetBrains Mono 用于代码和关键信息，Inter 用于正文
- **响应式交互**：点击即反馈，使用平滑但克制的过渡动画（200-300ms）

---

## 语言使用规范

### 产品语言（全英文）

- **所有 UI 显示文本**：使用英文（按钮、标题、提示、状态文字等）
- **代码标识符**：变量名、函数名、类名、组件名、文件名均使用英文
- **用户可见的错误信息和提示信息**：使用英文

### 开发沟通（中文）

- **代码注释**：使用中文
- **技术文档**：使用中文
- **开发沟通交流**：使用中文
- **Git Commit Message**：可中英混合

### 示例

```typescript
// ✅ 正确的代码风格
interface ModelConfig {
  id: string;
  provider: string;
  maxTokens: number;
}

// 保存模型配置到本地存储
/**
 * @param config - 模型配置对象
 */
function saveModelConfig(config: ModelConfig): void {
  // 实现逻辑...
}

// ✅ UI 文本全英文
<button>SAVE CONFIG</button>
<span>Model connection failed</span>

// ❌ 错误：UI 中出现中文
<button>保存配置</button>
<span>模型连接失败</span>
```

